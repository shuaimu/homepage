<HTML>
<HEAD>
<TITLE>./github-lab1/dslabs-cpp-BruceWang3077/src/deptran/raft/service.cc</TITLE>
</HEAD>
<BODY BGCOLOR=white>
<HR>
./github-lab1/dslabs-cpp-BruceWang3077/src/deptran/raft/service.cc<p><PRE>

#include "../marshallable.h"
#include "service.h"
#include "server.h"

namespace janus
{

  RaftServiceImpl::RaftServiceImpl(TxLogServer *sched)
      : svr_((RaftServer *)sched)
  {
    struct timespec curr_time;
    clock_gettime(CLOCK_MONOTONIC_RAW, &curr_time);
    srand(curr_time.tv_nsec);
  }

  void RaftServiceImpl::HandleRequestVote(const uint64_t &cur_term,
                                          const uint32_t &candidate_id,
<A NAME="1"></A><FONT color = #00FF00><A HREF="match89-1.html#1" TARGET="1"><IMG SRC="../../../bitmaps/tm_1_13.gif" ALT="other" BORDER="0" ALIGN=left></A>

                                          const uint32_t &last_log_index,
                                          const uint64_t &last_log_term,
                                          uint64_t *ret1,
                                          bool_t *vote_granted,
                                          bool_t *connection,
                                          rrr::DeferredReply *defer)
  {
    /* Your code here */
    svr_-&gt;handleRequestVote(cur_term, candidate_id, last_log_index, last_log_term, ret1, vote_granted);
</FONT>    *connection = true;
    defer-&gt;reply();
  }

  void RaftServiceImpl::HandleAppendEntries(const vector&lt;MarshallDeputy&gt; &md_cmd,
                                            const vector&lt;uint32_t&gt; &indices,
                                            const vector&lt;uint64_t&gt; &terms,
                                            const bool_t &is_heartbeat,
                                            const uint64_t &leader_term,
                                            const uint32_t &leader_id,
                                            const uint32_t &prev_log_index,
                                            const uint64_t &prev_log_term,
                                            const uint32_t &leader_commit,
<A NAME="0"></A><FONT color = #FF0000><A HREF="match89-1.html#0" TARGET="1"><IMG SRC="../../../bitmaps/tm_0_19.gif" ALT="other" BORDER="0" ALIGN=left></A>

                                            uint64_t *return_term,
                                            bool_t *followerAppendOK,
                                            uint32_t *last_replicated,
                                            bool_t *connection,
                                            rrr::DeferredReply *defer)
  {
    /* Your code here */
    svr_-&gt;handleAppendEntries(md_cmd, indices, terms, is_heartbeat, leader_term, leader_id, prev_log_index, prev_log_term, leader_commit, return_term, followerAppendOK, last_replicated);
</FONT>    // std::shared_ptr&lt;Marshallable&gt; cmd = const_cast&lt;MarshallDeputy &&gt;(md_cmd).sp_data_;
    *connection = true;
    defer-&gt;reply();
  }

  void RaftServiceImpl::HandleHelloRpc(const string &req,
                                       string *res,
                                       rrr::DeferredReply *defer)
  {
    /* Your code here */
    Log_info("receive an rpc: %s", req.c_str());
    *res = "world";
    defer-&gt;reply();
  }

} // namespace janus;
</PRE>
</PRE>
</BODY>
</HTML>
